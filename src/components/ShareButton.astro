---
/**
 * Share Button Component
 * Provides native sharing on supported platforms, fallback copy to clipboard
 */

interface Props {
  title: string;
  text?: string;
  url?: string;
  className?: string;
}

const { title, text, url, className = '' } = Astro.props;
const shareText = text || `Check out ${title} on Bay Navigator`;
---

<button
  type="button"
  class:list={['share-btn', className]}
  data-share-title={title}
  data-share-text={shareText}
  data-share-url={url}
  aria-label={`Share ${title}`}
>
  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
    ></path>
  </svg>
  <span class="sr-only">Share</span>
</button>

<style>
  .share-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.15s ease-in-out;
    color: #6b7280;
    min-width: 44px;
    min-height: 44px;
  }

  .share-btn:hover {
    color: #005a5f;
    background-color: #f0fdfa;
  }

  .share-btn:focus-visible {
    outline: 2px solid #005a5f;
    outline-offset: 2px;
  }

  :global(.dark) .share-btn {
    color: #9ca3af;
  }

  :global(.dark) .share-btn:hover {
    color: #5eead4;
    background-color: rgba(94, 234, 212, 0.1);
  }
</style>

<script>
  function initShareButtons(): void {
    const buttons = document.querySelectorAll<HTMLButtonElement>('.share-btn');

    buttons.forEach((button) => {
      const title = button.dataset.shareTitle || 'Bay Navigator';
      const text = button.dataset.shareText || '';
      const url = button.dataset.shareUrl || window.location.href;

      button.addEventListener('click', async () => {
        // Try native Web Share API first
        if (navigator.share) {
          try {
            await navigator.share({ title, text, url });
            return;
          } catch (err) {
            // User cancelled or error - fall through to clipboard
            if ((err as Error).name === 'AbortError') return;
          }
        }

        // Fallback: copy URL to clipboard
        try {
          await navigator.clipboard.writeText(url);
          const toast = (window as any).toast;
          if (toast) {
            toast.success('Link copied to clipboard');
          }
        } catch {
          // Clipboard failed - show manual copy dialog
          prompt('Copy this link:', url);
        }
      });
    });
  }

  document.addEventListener('DOMContentLoaded', initShareButtons);
  document.addEventListener('astro:page-load', initShareButtons);
</script>
