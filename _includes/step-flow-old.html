<div id="step-flow" class="step-flow-overlay" role="dialog" aria-modal="true" aria-label="Find programs">
  <div class="step-flow-content" role="document">
    <div class="step-flow-header">
      <h2>Find programs that match your needs</h2>
      <button type="button" class="step-flow-skip" aria-label="Skip and browse all programs">Skip to all programs</button>
    </div>

    <!-- Step 1: Eligibility -->
    <section class="step" id="step-1" aria-labelledby="step-1-title">
      <div class="step-progress" aria-label="Progress">Step 1 of 2</div>
      <h3 id="step-1-title">Which of these apply to you?</h3>
      <p class="step-help">Select all that apply to see relevant programs.</p>

      <fieldset class="eligibility-options">
        <legend class="sr-only">Eligibility options</legend>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="low-income">
          <span class="option-content">
            <span class="option-icon">üí≥</span>
            <span class="option-label">SNAP/EBT/Medi-Cal</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="seniors">
          <span class="option-content">
            <span class="option-icon">üëµ</span>
            <span class="option-label">Seniors (65+)</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="youth">
          <span class="option-content">
            <span class="option-icon">üßí</span>
            <span class="option-label">Youth</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="college-students">
          <span class="option-content">
            <span class="option-icon">üéì</span>
            <span class="option-label">College Students</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="veterans">
          <span class="option-content">
            <span class="option-icon">üéñÔ∏è</span>
            <span class="option-label">Veterans / Active Duty</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="families">
          <span class="option-content">
            <span class="option-icon">üë®‚Äçüë©‚Äçüëß</span>
            <span class="option-label">Families</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="disability">
          <span class="option-content">
            <span class="option-icon">üßë‚Äçü¶Ω</span>
            <span class="option-label">People with Disabilities</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="nonprofits">
          <span class="option-content">
            <span class="option-icon">ü§ù</span>
            <span class="option-label">Nonprofit Organizations</span>
          </span>
        </label>
        <label class="option-card">
          <input type="checkbox" name="eligibility" value="everyone">
          <span class="option-content">
            <span class="option-icon">üåé</span>
            <span class="option-label">Everyone</span>
          </span>
        </label>
      </fieldset>

      <div class="step-actions">
        <button type="button" class="btn-primary step-next" data-next="2">Continue</button>
      </div>
    </section>

    <!-- Step 2: County -->
    <section class="step" id="step-2" aria-labelledby="step-2-title" hidden>
      <h3 id="step-2-title">Step 2: Select your county</h3>
      <p class="step-help">We‚Äôll include Bay Area-wide, Statewide, and Nationwide results automatically.</p>

      <fieldset class="county-options">
        <legend class="sr-only">County options</legend>
        <label><input type="radio" name="county" value="San Francisco"> San Francisco</label>
        <label><input type="radio" name="county" value="Alameda County"> Alameda County</label>
        <label><input type="radio" name="county" value="Contra Costa County"> Contra Costa County</label>
        <label><input type="radio" name="county" value="San Mateo County"> San Mateo County</label>
        <label><input type="radio" name="county" value="Santa Clara County"> Santa Clara County</label>
        <label><input type="radio" name="county" value="Marin County"> Marin County</label>
        <label><input type="radio" name="county" value="Napa County"> Napa County</label>
        <label><input type="radio" name="county" value="Solano County"> Solano County</label>
        <label><input type="radio" name="county" value="Sonoma County"> Sonoma County</label>
        <label><input type="radio" name="county" value="none"> None of the above</label>
      </fieldset>

      <div class="step-actions">
        <button type="button" class="step-back" data-back="1">Back</button>
        <button type="button" class="step-submit">Show my results</button>
      </div>

      <div class="preferences-section">
        <details>
          <summary>Save preferences for next time</summary>
          <div class="pref-content">
            <p class="pref-help">Your selections are saved locally on your device only.</p>
            <button type="button" class="pref-save">Save these preferences</button>
            <button type="button" class="pref-apply-saved" hidden>Load saved preferences</button>
          </div>
        </details>
      </div>
    </section>
  </div>
</div>

<style>
.step-flow-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
.step-flow-content {
  width: min(920px, 94vw);
  max-height: 94vh;
  overflow: auto;
  background: var(--bg, #fff);
  color: var(--fg, #1a202c);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  padding: 2rem;
}
.step-flow-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  padding-bottom: 1.5rem;
  margin-bottom: 2rem;
  border-bottom: 2px solid rgba(0,0,0,0.08);
}
.step-flow-header h2 {
  margin: 0;
  font-size: 1.75rem;
  font-weight: 700;
}
.step-flow-skip {
  background: transparent;
  border: none;
  color: #2563eb;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  text-decoration: underline;
}
.step-flow-skip:hover { color: #1e40af; }
.step { display: block; }
.step-progress {
  font-size: 0.875rem;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 1rem;
}
.step h3 {
  font-size: 1.5rem;
  font-weight: 700;
  margin: 0 0 0.5rem;
}
.step-help {
  margin: 0 0 1.5rem;
  color: #6b7280;
  font-size: 1rem;
}
.eligibility-options, .county-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}
.option-card {
  position: relative;
  display: block;
  cursor: pointer;
}
.option-card input[type="checkbox"],
.option-card input[type="radio"] {
  position: absolute;
  opacity: 0;
}
.option-content {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  border: 2px solid #d1d5db;
  border-radius: 12px;
  background: var(--bg, #fff);
  transition: all 0.15s ease;
  font-size: 1rem;
  font-weight: 500;
}
.option-card:hover .option-content {
  border-color: #2563eb;
  background: #eff6ff;
}
.option-card input:checked + .option-content {
  border-color: #2563eb;
  background: #dbeafe;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}
.option-icon {
  font-size: 1.5rem;
  line-height: 1;
}
.option-label {
  flex: 1;
  font-weight: 600;
}
.step-actions {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(0,0,0,0.08);
}
.step-back, .step-next, .step-submit,
.btn-primary, .btn-secondary {
  appearance: none;
  border: none;
  border-radius: 10px;
  padding: 0.875rem 2rem;
  font-weight: 600;
  font-size: 1.0625rem;
  cursor: pointer;
  transition: all 0.15s ease;
}
.step-next, .step-submit, .btn-primary {
  background: #2563eb;
  color: #fff;
}
.step-next:hover, .step-submit:hover, .btn-primary:hover {
  background: #1e40af;
}
.step-back, .btn-secondary {
  background: #e5e7eb;
  color: #374151;
}
.step-back:hover, .btn-secondary:hover {
  background: #d1d5db;
}
.preferences-section {
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(0,0,0,0.08);
}
.preferences-section summary {
  cursor: pointer;
  font-weight: 600;
  color: #2563eb;
  list-style: none;
}
.preferences-section summary::-webkit-details-marker { display: none; }
.pref-content {
  margin-top: 1rem;
  padding: 1rem;
  background: #f9fafb;
  border-radius: 8px;
}
.pref-help {
  margin: 0 0 0.75rem;
  font-size: 0.875rem;
  color: #6b7280;
}
.pref-save, .pref-apply-saved {
  background: #e5e7eb;
  color: #374151;
  border: none;
  border-radius: 8px;
  padding: 0.625rem 1.25rem;
  font-weight: 600;
  cursor: pointer;
  margin-right: 0.5rem;
}
.pref-save:hover, .pref-apply-saved:hover { background: #d1d5db; }

@media (prefers-color-scheme: dark) {
  .step-flow-content { --bg: #1f2937; --fg: #f3f4f6; }
  .option-content { border-color: #4b5563; background: #1f2937; }
  .option-card:hover .option-content { background: #374151; }
  .option-card input:checked + .option-content {
    border-color: #3b82f6;
    background: #1e3a8a;
  }
  .pref-content { background: #374151; }
}

.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
</style>