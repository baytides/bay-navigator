<!-- Print-only header for favorites -->
<div class="print-favorites-header" aria-hidden="true">
  <p>Bay Navigator - baynavigator.org</p>
  <p class="print-date">Generated: <span id="favorites-print-date"></span></p>
</div>

<div id="favorites-view" class="favorites-view">
  <!-- Print/Export Controls -->
  <div class="favorites-toolbar">
    <div class="print-export-controls favorites-export" role="group" aria-label="Export saved programs">
      <button type="button" class="export-btn" id="print-favorites" aria-label="Print saved programs list">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <polyline points="6 9 6 2 18 2 18 9"></polyline>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
          <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        <span>Print List</span>
      </button>
      <button type="button" class="export-btn" id="export-favorites-pdf" aria-label="Save saved programs as PDF">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="12" y1="18" x2="12" y2="12"></line>
          <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
        <span>Save PDF</span>
      </button>
    </div>
    <button id="clear-favorites" class="btn-secondary" type="button">Clear All</button>
  </div>

  <div id="favorites-list" class="favorites-list">
    <!-- Favorites will be rendered here -->
  </div>

  <div id="no-favorites" class="no-results" style="display: none;">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.3; margin-bottom: 1rem;">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
    </svg>
    <h3>No saved programs yet</h3>
    <p>Click the heart icon on any program to save it here</p>
    <a href="/" class="btn-primary" style="margin-top: 1rem; display: inline-block; text-decoration: none;">Browse Programs</a>
  </div>
</div>

<style>
.favorites-view {
  padding: 1rem 0;
}

.favorites-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-color, #e5e7eb);
}

.favorites-export {
  display: flex;
  gap: 0.5rem;
}

.export-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-secondary, #4b5563);
  background: var(--bg-surface, #f9fafb);
  border: 1px solid var(--border-color, #e5e7eb);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.export-btn:hover {
  background: var(--bg-hover, #f3f4f6);
  border-color: var(--border-hover, #d1d5db);
}

.btn-secondary {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: #dc2626;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-secondary:hover {
  background: #fee2e2;
  border-color: #fca5a5;
}

.favorites-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.favorites-card {
  padding: 1rem 1.25rem;
  background: var(--bg-surface, #ffffff);
  border: 1px solid var(--border-color, #e5e7eb);
  border-radius: 12px;
  transition: all 0.2s;
}

.favorites-card:hover {
  border-color: var(--border-hover, #d1d5db);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.favorites-card h3 {
  margin: 0 0 0.5rem;
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary, #111827);
}

.favorites-card p {
  margin: 0;
  font-size: 0.875rem;
}

.favorites-card a {
  color: var(--link-color, #2563eb);
  text-decoration: none;
}

.favorites-card a:hover {
  text-decoration: underline;
}

.no-results {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--text-secondary, #6b7280);
}

.no-results h3 {
  margin: 0 0 0.5rem;
  color: var(--text-primary, #374151);
}

.no-results p {
  margin: 0;
}

/* Print styles */
@media print {
  .favorites-toolbar {
    display: none;
  }

  .print-favorites-header {
    display: block !important;
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #000;
  }
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .favorites-card {
    background: var(--dark-surface, #1f2937);
    border-color: var(--dark-border, #374151);
  }

  .favorites-card h3 {
    color: var(--dark-text, #f9fafb);
  }

  .export-btn {
    background: var(--dark-surface, #1f2937);
    border-color: var(--dark-border, #374151);
    color: var(--dark-text-secondary, #9ca3af);
  }

  .export-btn:hover {
    background: var(--dark-hover, #374151);
  }
}

body[data-theme="dark"] .favorites-card {
  background: var(--dark-surface, #1f2937);
  border-color: var(--dark-border, #374151);
}

body[data-theme="dark"] .favorites-card h3 {
  color: var(--dark-text, #f9fafb);
}

body[data-theme="dark"] .export-btn {
  background: var(--dark-surface, #1f2937);
  border-color: var(--dark-border, #374151);
  color: var(--dark-text-secondary, #9ca3af);
}

body[data-theme="dark"] .export-btn:hover {
  background: var(--dark-hover, #374151);
}

/* Mobile optimizations */
@media (max-width: 640px) {
  .favorites-view {
    padding: 0.5rem 0;
  }

  .favorites-toolbar {
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    gap: 0.75rem;
  }

  .export-btn {
    padding: 0.375rem 0.75rem;
    font-size: 0.8125rem;
    border-radius: 6px;
  }

  .export-btn svg {
    width: 16px;
    height: 16px;
  }

  .btn-secondary {
    padding: 0.375rem 0.75rem;
    font-size: 0.8125rem;
    border-radius: 6px;
  }

  .favorites-list {
    gap: 0.75rem;
  }

  .favorites-card {
    padding: 0.875rem 1rem;
    border-radius: 10px;
  }

  .favorites-card h3 {
    font-size: 0.9375rem;
  }

  .no-results {
    padding: 2rem 1rem;
  }

  .no-results svg {
    width: 40px;
    height: 40px;
    margin-bottom: 0.75rem;
  }

  .no-results h3 {
    font-size: 1rem;
  }

  .no-results p {
    font-size: 0.875rem;
  }
}
</style>

<script>
(function() {
  'use strict';

  function init() {
    var clearFavoritesBtn = document.getElementById('clear-favorites');
    var printFavoritesBtn = document.getElementById('print-favorites');
    var exportPdfBtn = document.getElementById('export-favorites-pdf');
    var favoritesList = document.getElementById('favorites-list');
    var noFavorites = document.getElementById('no-favorites');
    var printDateEl = document.getElementById('favorites-print-date');

    if (!favoritesList || !noFavorites) return;
    if (!window.favorites) return;

    // Set print date
    function updatePrintDate() {
      if (printDateEl) {
        var options = { year: 'numeric', month: 'long', day: 'numeric' };
        printDateEl.textContent = new Date().toLocaleDateString('en-US', options);
      }
    }

    // Clear all favorites
    if (clearFavoritesBtn) {
      clearFavoritesBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to remove all saved programs?')) {
          window.favorites.clear();
          renderFavorites();
        }
      });
    }

    // Print favorites
    if (printFavoritesBtn) {
      printFavoritesBtn.addEventListener('click', function() {
        var favs = typeof window.favorites.list === 'function' ? window.favorites.list() : [];
        if (favs.length === 0) {
          alert('No saved programs to print. Save some programs first by clicking the heart icon.');
          return;
        }
        updatePrintDate();
        window.print();
      });
    }

    // Export favorites as PDF
    if (exportPdfBtn) {
      exportPdfBtn.addEventListener('click', function() {
        var favs = typeof window.favorites.list === 'function' ? window.favorites.list() : [];
        if (favs.length === 0) {
          alert('No saved programs to export. Save some programs first by clicking the heart icon.');
          return;
        }
        updatePrintDate();
        alert('In the print dialog that opens:\n\n1. Select "Save as PDF" as your destination\n2. Click "Save"\n\nYour saved programs will be exported with Bay Navigator branding.');
        window.print();
      });
    }

    // Update date before printing
    window.addEventListener('beforeprint', updatePrintDate);

    // Render favorites
    function renderFavorites() {
      var favs = typeof window.favorites.list === 'function' ? window.favorites.list() : [];

      if (!favs.length) {
        favoritesList.innerHTML = '';
        noFavorites.style.display = 'block';
        if (clearFavoritesBtn) clearFavoritesBtn.style.display = 'none';
        return;
      }

      noFavorites.style.display = 'none';
      if (clearFavoritesBtn) clearFavoritesBtn.style.display = '';

      var items = favs
        .map(function(f) {
          return '<div class="favorite-row favorites-card"><h3>' + f.title + '</h3><p><a href="' + f.url + '">' + f.linkText + '</a></p></div>';
        })
        .join('');

      favoritesList.innerHTML = items;
    }

    // Initial render
    renderFavorites();

    // Listen for changes
    document.addEventListener('favoritesUpdated', renderFavorites);
  }

  // Initialize when favorites.js is ready
  if (window.favorites) {
    init();
  } else {
    document.addEventListener('favoritesReady', init, { once: true });
  }
})();
</script>
